a:= bat.new(:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,true:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
bat.append(a,false:bit);
mosaic.compress(a,"{compression_type}");
c:= mosaic.decompress(a);
io.print(a, c);

sa:= algebra.select(a,nil:bit, nil:bit,false,false,false);
sc:= mosaic.select (c,nil:bit, nil:bit,false,false,false);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, nil:bit,false,false,false);
sc:= mosaic.select (c,true:bit, nil:bit,false,false,false);
tsa:= algebra.thetaselect(a,true:bit, ">");
tsc:= mosaic.thetaselect (c,true:bit, ">");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,false:bit, nil:bit,false,false,false);
sc:= mosaic.select (c,false:bit, nil:bit,false,false,false);
tsa:= algebra.thetaselect(a,false:bit, ">");
tsc:= mosaic.thetaselect (c,false:bit, ">");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,nil:bit, false:bit,false,false,false);
sc:= mosaic.select (c,nil:bit, false:bit,false,false,false);
tsa:= algebra.thetaselect(a,false:bit, "<");
tsc:= mosaic.thetaselect (c,false:bit, "<");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,false:bit, false:bit,false,false,false);
sc:= mosaic.select (c,false:bit, false:bit,false,false,false);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, true:bit,false,false,false);
sc:= mosaic.select (c,nil:bit, true:bit,false,false,false);
tsa:= algebra.thetaselect(a,true:bit, "<");
tsc:= mosaic.thetaselect (c,true:bit, "<");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,true:bit, true:bit,false,false,false);
sc:= mosaic.select (c,true:bit, true:bit,false,false,false);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, true:bit,false,false,false);
sc:= mosaic.select (c,false:bit, true:bit,false,false,false);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, nil:bit,true,false,false);
sc:= mosaic.select (c,nil:bit, nil:bit,true,false,false);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, nil:bit,true,false,false);
sc:= mosaic.select (c,true:bit, nil:bit,true,false,false);
tsa:= algebra.thetaselect(a,true:bit, ">=");
tsc:= mosaic.thetaselect (c,true:bit, ">=");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,false:bit, nil:bit,true,false,false);
sc:= mosaic.select (c,false:bit, nil:bit,true,false,false);
tsa:= algebra.thetaselect(a,false:bit, ">=");
tsc:= mosaic.thetaselect (c,false:bit, ">=");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,nil:bit, false:bit,true,false,false);
sc:= mosaic.select (c,nil:bit, false:bit,true,false,false);
tsa:= algebra.thetaselect(a,false:bit, "<");
tsc:= mosaic.thetaselect (c,false:bit, "<");
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,true,false,false);
sc:= mosaic.select (c,false:bit, false:bit,true,false,false);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, true:bit,true,false,false);
sc:= mosaic.select (c,nil:bit, true:bit,true,false,false);
tsa:= algebra.thetaselect(a,true:bit, "<");
tsc:= mosaic.thetaselect (c,true:bit, "<");
io.print(sa, sc);

# Should give empty result
sa:= algebra.select(a,false:bit, false:bit,false,true,false);
sc:= mosaic.select (c,false:bit, false:bit,false,true,false);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,true,false,false);
sc:= mosaic.select (c,false:bit, false:bit,true,false,false);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,false,false,false);
sc:= mosaic.select (c,false:bit, false:bit,false,false,false);
io.print(sa, sc);

# Should give all non-nil value
sa:= algebra.select(a,false:bit, false:bit,false,true,true);
sc:= mosaic.select (c,false:bit, false:bit,false,true,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,true,false,true);
sc:= mosaic.select (c,false:bit, false:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,false,false,true);
sc:= mosaic.select (c,false:bit, false:bit,false,false,true);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, true:bit,true,false,false);
sc:= mosaic.select (c,true:bit, true:bit,true,false,false);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, false:bit,true,false,false);
sc:= mosaic.select (c,true:bit, false:bit,true,false,false);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, false:bit,true,false,true);
sc:= mosaic.select (c,true:bit, false:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, true:bit,true,false,false);
sc:= mosaic.select (c,false:bit, true:bit,true,false,false);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, nil:bit,false,true,false);
sc:= mosaic.select (c,nil:bit, nil:bit,false,true,false);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, nil:bit,false,true,false);
sc:= mosaic.select (c,true:bit, nil:bit,false,true,false);
tsa:= algebra.thetaselect(a,true:bit, ">");
tsc:= mosaic.thetaselect (c,true:bit, ">");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,false:bit, nil:bit,false,true,false);
sc:= mosaic.select (c,false:bit, nil:bit,false,true,false);
tsa:= algebra.thetaselect(a,false:bit, ">");
tsc:= mosaic.thetaselect (c,false:bit, ">");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,nil:bit, false:bit,false,true,false);
sc:= mosaic.select (c,nil:bit, false:bit,false,true,false);
tsa:= algebra.thetaselect(a,false:bit, "<=");
tsc:= mosaic.thetaselect (c,false:bit, "<=");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,false:bit, false:bit,false,true,false);
sc:= mosaic.select (c,false:bit, false:bit,false,true,false);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, true:bit,false,true,false);
sc:= mosaic.select (c,nil:bit, true:bit,false,true,false);
tsa:= algebra.thetaselect(a,true:bit, "<=");
tsc:= mosaic.thetaselect (c,true:bit, "<=");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,true:bit, true:bit,false,true,false);
sc:= mosaic.select (c,true:bit, true:bit,false,true,false);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, true:bit,false,true,false);
sc:= mosaic.select (c,false:bit, true:bit,false,true,false);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, nil:bit,true,true,false);
sc:= mosaic.select (c,true:bit, nil:bit,true,true,false);
tsa:= algebra.thetaselect(a,true:bit, ">=");
tsc:= mosaic.thetaselect (c,true:bit, ">=");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,false:bit, nil:bit,true,true,false);
sc:= mosaic.select (c,false:bit, nil:bit,true,true,false);
tsa:= algebra.thetaselect(a,false:bit, ">=");
tsc:= mosaic.thetaselect (c,false:bit, ">=");
io.print(sa, sc, tsa, tsc);

sa:= algebra.select(a,nil:bit, false:bit,true,true,false);
sc:= mosaic.select (c,nil:bit, false:bit,true,true,false);
tsa:= algebra.thetaselect(a,false:bit, "<=");
tsc:= mosaic.thetaselect (c,false:bit, "<=");
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,true,true,false);
sc:= mosaic.select (c,false:bit, false:bit,true,true,false);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, true:bit,true,true,false);
sc:= mosaic.select (c,nil:bit, true:bit,true,true,false);
tsa:= algebra.thetaselect(a,true:bit, "<=");
tsc:= mosaic.thetaselect (c,true:bit, "<=");
io.print(sa, sc);

sa:= algebra.select(a,true:bit, true:bit,true,true,false);
sc:= mosaic.select (c,true:bit, true:bit,true,true,false);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, true:bit,true,true,false);
sc:= mosaic.select (c,false:bit, true:bit,true,true,false);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, nil:bit,false,false,true);
sc:= mosaic.select (c,nil:bit, nil:bit,false,false,true);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, nil:bit,false,false,true);
sc:= mosaic.select (c,true:bit, nil:bit,false,false,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, nil:bit,false,false,true);
sc:= mosaic.select (c,false:bit, nil:bit,false,false,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, false:bit,false,false,true);
sc:= mosaic.select (c,nil:bit, false:bit,false,false,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,false,false,true);
sc:= mosaic.select (c,false:bit, false:bit,false,false,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, true:bit,false,false,true);
sc:= mosaic.select (c,nil:bit, true:bit,false,false,true);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, true:bit,false,false,true);
sc:= mosaic.select (c,true:bit, true:bit,false,false,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, true:bit,false,false,true);
sc:= mosaic.select (c,false:bit, true:bit,false,false,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, nil:bit,true,false,true);
sc:= mosaic.select (c,nil:bit, nil:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, nil:bit,true,false,true);
sc:= mosaic.select (c,true:bit, nil:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, nil:bit,true,false,true);
sc:= mosaic.select (c,false:bit, nil:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, false:bit,true,false,true);
sc:= mosaic.select (c,nil:bit, false:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,true,false,true);
sc:= mosaic.select (c,false:bit, false:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, true:bit,true,false,true);
sc:= mosaic.select (c,nil:bit, true:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, true:bit,true,false,true);
sc:= mosaic.select (c,true:bit, true:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, true:bit,true,false,true);
sc:= mosaic.select (c,false:bit, true:bit,true,false,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, nil:bit,false,true,true);
sc:= mosaic.select (c,nil:bit, nil:bit,false,true,true);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, nil:bit,false,true,true);
sc:= mosaic.select (c,true:bit, nil:bit,false,true,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, nil:bit,false,true,true);
sc:= mosaic.select (c,false:bit, nil:bit,false,true,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, false:bit,false,true,true);
sc:= mosaic.select (c,nil:bit, false:bit,false,true,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,false,true,true);
sc:= mosaic.select (c,false:bit, false:bit,false,true,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, true:bit,false,true,true);
sc:= mosaic.select (c,nil:bit, true:bit,false,true,true);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, true:bit,false,true,true);
sc:= mosaic.select (c,true:bit, true:bit,false,true,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, true:bit,false,true,true);
sc:= mosaic.select (c,false:bit, true:bit,false,true,true);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, nil:bit,true,true,true);
sc:= mosaic.select (c,true:bit, nil:bit,true,true,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, nil:bit,true,true,true);
sc:= mosaic.select (c,false:bit, nil:bit,true,true,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, false:bit,true,true,true);
sc:= mosaic.select (c,nil:bit, false:bit,true,true,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, false:bit,true,true,true);
sc:= mosaic.select (c,false:bit, false:bit,true,true,true);
io.print(sa, sc);

sa:= algebra.select(a,nil:bit, true:bit,true,true,true);
sc:= mosaic.select (c,nil:bit, true:bit,true,true,true);
io.print(sa, sc);

sa:= algebra.select(a,true:bit, true:bit,true,true,true);
sc:= mosaic.select (c,true:bit, true:bit,true,true,true);
io.print(sa, sc);

sa:= algebra.select(a,false:bit, true:bit,true,true,true);
sc:= mosaic.select (c,false:bit, true:bit,true,true,true);
io.print(sa, sc);

b:= bat.new(:bit);
bat.append(b,false:bit);
bat.append(b,true:bit);
bat.append(b,true:bit);
bat.append(b,true:bit);
bat.append(b,true:bit);
bat.append(b,false:bit);
bat.append(b,true:bit);
bat.append(b,false:bit);
bat.append(b,true:bit);
bat.append(b,false:bit);

(l,r)   := algebra.join(a,b,nil:bat,nil:bat, false, 0:lng);
(r, p) := algebra.sort(r, false:bit, false:bit, true:bit);
l      := algebra.projection(p, l);

(lc,rc) := mosaic.join (c,b,nil:bat,nil:bat, false, 0:lng);
(rc, p) := algebra.sort(rc, false:bit, false:bit, true:bit);
lc      := algebra.projection(p, lc);
io.print(l,lc);
io.print(r,rc);

tsa:= mosaic.thetaselect(a,false:bit, ">");
tsap    := algebra.projection(tsa, a);
tsapc   := mosaic.projection(tsa, c);
io.print(tsap, tsapc);

sa:= algebra.select(a,false:bit, nil:bit,false,false,false);
sap    := algebra.projection(tsa, a);
sapc   := mosaic.projection(tsa, c);
io.print(sap, sapc);

pl  := algebra.projection(l, a);
plc := mosaic.projection(l, c);
io.print(pl, plc);
